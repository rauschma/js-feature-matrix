<!doctype html>
<html xmlns="http://www.w3.org/1999/html">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>JavaScript feature matrix</title>
        <link href="main.css" type="text/css" rel="stylesheet">
        <script>
            var isJsonAvailable = (typeof JSON === "object" && JSON !== null);
        </script>
        <script src="lib/jquery.min.js"></script>
        <script src="lib/underscore-min.js"></script>
        <script src="lib/json2-min.js"></script>
        <script src="matrix_content.js"></script>
        <script>
            var supportKeys = matrix.spec[""];

            var tableStart = (
                    '<table class="framed">'
                    + "<tr><th>Functionality</th><th>Standard</th><th>This browser</th>"
                    + _.reduce(supportKeys, function (result, cur) { return result + "<th>" + cur + "</th>" }, "")
                    + "</tr>"
            );
            var tableRow = '<tr><td><%=name%></td><td><%=version%></td><td class="<%=result==="yes"?"resultyes":"resultno"%>"><%=result%></td><% _.forEach(matrix.spec[obj.key], function (supportedVersion) { %><td><%=supportedVersion%></td><% }); %></tr>\n';
            var tableEnd = '</table>';


            $(document).ready(function () {
                var rowTemplate = _.template(tableRow);

                var statistics = {};

                var html = "";
                _.forEach(matrix.tests, function (test) {
                    if (typeof test === "string") {
                        var insideTable = (html.length > 0);
                        if (insideTable) {
                            html += tableEnd;
                        }
                        html += "<h2>"+test+"</h2>";
                        html += tableStart;
                    } else {
                        var data = _.extend({}, test); // copy
                        var result;
                        if (test.isTypeof) {
                            data.name = "<tt>"+test.name+"</tt>";
                            result = typeof eval(test.name) === test.isTypeof;
                        } else if (test.object) {
                            data.name = "<tt>"+test.name + ": "+test.methods.join(", ")+"</tt>";
                            result = checkMethods(test);
                        } else {
                            try {
                                result = test.check();
                            } catch (e) {
                                result = false;
                            }
                        }
                        statistics[test.key] = result;
                        data.result = (result ? "yes" : "no");
                        if (html.length === 0) {
                            html = tableStart;
                        }
                        html += rowTemplate(data);
                    }
                });
                $("#testResults").append(html);

                statistics.userAgent = navigator.userAgent;
                $("#browserStats").text(JSON.stringify(statistics, null, 4)); // TODO
            });
            function checkMethods(test) {
                 var obj = test.object;
                 var methodNames = test.methods;
                 var methodCount = 0;
                 _.forEach(methodNames, function (methodName) {
                     if (typeof obj[methodName] === "function") {
                         methodCount++;
                     }
                 });
                 return methodCount === methodNames.length;
            }
        </script>
    </head>
    <body>
        <h1>JavaScript feature matrix</h1>

        This matrix tracks which JavaScript language features are supported by which browsers. There are two ways in which you can contribute:
        <ul>
            <li>Contribute feature tests: Is there a language feature that once caused you problems by not being supported in a browser? GitHub: <a href="https://github.com/rauschma/js-feature-matrix">js-feature-matrix</a>.
            </li>
            <li>Contribute matrix data: There is a Google spreadsheet for managing the data. Contact me and I’ll give you access. Contact: <tt>axel AT rauschma DOT de</tt> or <a href="https://twitter.com/rauschma"><tt>@rauschma</tt></a>.
            </li>
            <li>Contribute your browser’s statistics: See section at the end of this page.</li>
        </ul>

        <div id="testResults"></div>

        <h2>Background</h2>

        On 2ality:
        <ul>
            <li><a href="http://www.2ality.com/2011/01/javascripts-strict-mode-summary.html">JavaScript’s strict mode: a summary</a></li>
            <li><a href="http://www.2ality.com/2011/10/strict-mode-hatred.html">JavaScript: Why the hatred for strict mode?</a> [explains named function expressions]</li>
            <li><a href="http://www.2ality.com/2011/01/reflection-and-meta-programming-in.html">Reflection and meta-programming in JavaScript</a> [getters and setters]</li>
            <li><a href="http://www.2ality.com/2011/06/object-literal-comma.html">Quick JavaScript tip: trailing commas inside an object literal</a></li>
        </ul>
        Other material:
        <ul>
            <li>“<a href="http://kangax.github.com/nfe/">Named function expressions demystified</a>” by kangax.</li>
        </ul>

        <h2>Acknowledgement</h2>

        This work is greatly indebted to “<a href="http://kangax.github.com/es5-compat-table/">ECMAScript 5 compatibility table</a>” by <a href="https://twitter.com/kangax/">kangax</a>,
        which inspired the structure of the table and provided some of the matrix data.

        <h2>Statistics as JSON</h2>

        Contribute your browser’s statistics via <a href="https://docs.google.com/spreadsheet/viewform?formkey=dEt4NERYRWFtc28xeE9QQ2pUdGhtcUE6MQ">this form</a>. If there are enough submissions, we should be able to compute the feature matrix automatically.

        <pre id="browserStats"></pre>
    </body>
</html>
